<!-- index/index.wxml -->
<view class="container">
  <!-- é¡¶éƒ¨çŠ¶æ€å¡ç‰‡ -->
  <view class="status-card {{isFasting ? 'fasting' : 'eating'}}">
    <view class="status-content">
      <view class="status-text {{isFasting ? 'fasting-text' : 'eating-text'}}">
        {{isFasting ? 'æ–­é£Ÿä¸­' : 'å¯è¿›é£Ÿ'}}
      </view>
      <view class="status-info">
        <view class="timer">
          {{fastingMode === '168' ? '16:8' : '20:4'}} æ¨¡å¼
        </view>
      </view>
    </view>
  </view>
  
  <!-- è¿›åº¦æ¡åŒºåŸŸ -->
  <view class="progress-section">
    <view class="progress-header">
      <text class="progress-title">è¿›é£Ÿçª—å£</text>
    </view>
    <view class="progress-container">
      <view class="progress-bar">
        <view class="progress-fill" style="width: {{progress}}"></view>
      </view>
      <view class="progress-labels">
        <text>{{eatingStart}}</text>
        <text>{{eatingEnd}}</text>
      </view>
    </view>
    
    <view class="progress-info">
      <text>å‰©ä½™æ—¶é—´ï¼š{{remainingTime}}å°æ—¶</text>
    </view>
  </view>
  
  <!-- ä»Šæ—¥è¿›é¤è®°å½• -->
  <view class="meal-section">
    <view class="section-header">
      <text class="section-title">ä»Šæ—¥è¿›é¤è®°å½•</text>
      <text class="meal-count">å·²è®°å½• {{todayMeals.length}} æ¬¡</text>
    </view>
    
    <view class="meal-scroll-container">
      <view class="meal-content">
        <view wx:if="{{todayMeals.length === 0}}" class="empty-tip">
          <image src="/images/empty.png" class="empty-icon"></image>
          <text>ä»Šæ—¥å°šæœªè®°å½•è¿›é¤</text>
        </view>
        
        <view wx:else class="meal-records">
          <block wx:for="{{todayMeals}}" wx:key="item">
            <view class="meal-item">
              <view class="meal-time">{{item}}</view>
              <view class="meal-type">{{getMealType(index)}}</view>
              <view class="meal-actions">
                <view class="edit-icon" bindtap="showTimePicker" data-index="{{index}}">âœ</view>
                <view class="delete-icon" bindtap="deleteMeal" data-index="{{index}}">âœ•</view>
              </view>
            </view>
          </block>
        </view>
      </view>
    </view>
  </view>
  
  <!-- æ—¶é—´é€‰æ‹©å™¨å¼¹çª— -->
  <view class="time-picker-modal" wx:if="{{showPicker}}">
    <view class="picker-container">
      <view class="picker-header">
        <text class="picker-title">ç¼–è¾‘è¿›é¤æ—¶é—´</text>
      </view>
      
      <picker 
        mode="time" 
        value="{{selectedTime}}" 
        start="00:00" 
        end="23:59" 
        bindchange="timeChange"
      >
        <view class="picker-display">
          <text class="picker-time">{{selectedTime}}</text>
          <text class="picker-hint">ç‚¹å‡»é€‰æ‹©æ—¶é—´</text>
        </view>
      </picker>
      
      <view class="picker-buttons">
        <button class="picker-btn cancel" bindtap="hidePicker">å–æ¶ˆ</button>
        <button class="picker-btn confirm" bindtap="updateMealTime">ç¡®å®š</button>
      </view>
    </view>
  </view>
  
  <!-- æµ®åŠ¨æŒ‰é’®ç»„ï¼ˆæ‹ç…§å’Œè®°å½•æŒ‰é’®æ°´å¹³æ’åˆ—ï¼‰ -->
  <view class="floating-actions">
    <button class="floating-button photo" bindtap="takeFoodPhoto">
      <view class="button-icon">ğŸ“·</view>
      <text>æ‹çƒ­é‡</text>
    </button>
    <button class="floating-button record" bindtap="recordMealNow">
      <view class="button-icon">+</view>
      <text>è®°å½•è¿›é¤</text>
    </button>
  </view>
</view>

<!-- é£Ÿç‰©è¯†åˆ«ç»“æœå¼¹çª— -->
<view class="food-result-modal" wx:if="{{showFoodResult}}">
  <view class="result-container">
    <view class="result-header">
      <text class="result-title">é£Ÿç‰©è¯†åˆ«ç»“æœ</text>
      <text class="close-icon" bindtap="closeFoodResult">Ã—</text>
    </view>
    
    <!-- è¯†åˆ«ç»“æœåˆ—è¡¨ -->
    <view class="recognition-results">
      <view class="result-item" 
        wx:for="{{recognizedFoods}}" 
        wx:key="index"
        bindtap="selectFood"
        data-index="{{index}}"
        class="{{selectedFoodIndex == index ? 'result-item-selected' : ''}}">
        <view class="result-item-header">
          <text class="food-name">{{item.name}}</text>
          <text class="recognition-probability">åŒ¹é…åº¦ {{item.probability}}%</text>
        </view>
        <text class="food-calories">{{item.calories}}</text>
      </view>
    </view>
    
    <!-- é€‰ä¸­é£Ÿç‰©è¯¦æƒ… -->
    <view class="selected-food-detail">
    <!-- ä¼˜å…ˆå±•ç¤ºç”¨æˆ·æ‹æ‘„çš„åŸå§‹å›¾ç‰‡ -->
  <view class="food-image-container">
    <text class="advice-title" style="margin-bottom: 15rpx; display: block;"></text>
    <image 
      src="{{takenImagePath}}" 
      mode="widthFix"
      binderror="onFoodImageError"
    ></image>
  </view>
      
      <view class="food-info">
        <text class="food-name">{{recognizedFood.name}}</text>
        <text class="food-calories">{{recognizedFood.calories}}</text>
        
        <view class="food-nutrition">
          <text>è¯†åˆ«å¯ä¿¡åº¦ï¼š{{recognizedFood.probability}}%</text>
        </view>
      </view>
      
      <!-- é£Ÿç‰©æè¿°ï¼ˆå¦‚æœæœ‰ï¼‰ -->
      <view class="food-description" wx:if="{{recognizedFood.description}}">
        <text class="advice-title">é£Ÿç‰©ç®€ä»‹</text>
        <text class="advice-content">{{recognizedFood.description}}</text>
      </view>
      
      <view class="diet-advice">
        <text class="advice-title">é¥®é£Ÿå»ºè®®</text>
        <text class="advice-content">{{dietAdvice}}</text>
      </view>
    </view>
    
    <view class="result-buttons">
      <button class="result-btn cancel" bindtap="closeFoodResult">å–æ¶ˆ</button>
      <button class="result-btn confirm" bindtap="saveFoodRecord">è®°å½•ç”¨é¤</button>
    </view>
  </view>
</view>

<!-- æ“ä½œåé¦ˆæç¤º -->
<view class="action-toast" wx:if="{{showMealActionToast}}">
  <text>{{mealActionFeedback}}</text>
</view>