<!-- index/index.wxml -->
<view class="container">
    <!-- çŠ¶æ€å¡ç‰‡ -->
    <view class="status-card {{isFasting ? 'fasting' : 'eating'}}">
        <view class="status-content">
            <view class="status-text {{isFasting ? 'fasting-text' : 'eating-text'}}">
                {{isFasting ? 'æ–­é£Ÿä¸­' : 'å¯è¿›é£Ÿ'}}
            </view>
            <view class="status-info">
                <view class="timer">
                    {{fastingMode === '168' ? '16:8' : '20:4'}} æ¨¡å¼
                </view>
                <view class="time-range">
                    <!-- è¿›é£Ÿçª—å£: {{eatingStart}} - {{eatingEnd}} -->
                </view>
            </view>
        </view>
    </view>

    <!-- åœ†å½¢æ—¶é—´è½´ -->
    <!-- <view class="circle-timeline-container">
        <view class="circle-bg">
            <view class="circle-fasting"></view>
            <view class="circle-eating" 
                  style="transform: rotate({{eatingStartAngle}}deg);clip-path: polygon(50% 50%, 50% 0%, {{getEatingEndPoint()}});"></view>
        </view>
        <view class="time-pointer" 
              style="transform: translate(-50%, -100%) rotate({{currentTimeAngle}}deg)"></view>
        <view class="circle-labels">
            <block wx:for="{{[0, 6, 12, 18]}}" wx:key="index">
                <view class="circle-label" 
                      style="transform: rotate({{item * 15}}deg) translate({{circleRadius - 30}}rpx) rotate(-{{item * 15}}deg)">
                    <text>{{item}}:00</text>
                </view>
            </block>
        </view>
        <view class="circle-now" 
              style="transform: rotate({{currentTimeAngle}}deg) translate({{circleRadius - 20}}rpx) rotate(-{{currentTimeAngle}}deg)">
            <view class="now-indicator"></view>
            <view class="now-label">{{currentHour}}:{{currentMinute}}</view>
        </view>
        <view class="circle-center"></view>
    </view> -->

    <!-- è¿›åº¦æ¡åŒºåŸŸ -->
    <view class="progress-section">
        <view class="progress-header">
            <text class="section-title">{{isFasting ? 'æ–­é£Ÿè¿›åº¦' : 'è¿›é£Ÿè¿›åº¦'}}</text>
            <text class="progress-percent">{{progress}}%</text>
        </view>
        <view class="progress-container">
            <view class="progress-bar">
                <view class="progress-fill" style="width: {{progress}}%"></view>
            </view>
            <view class="progress-labels">
                <text>{{isFasting ? 'æ–­é£Ÿå¼€å§‹' : 'è¿›é£Ÿå¼€å§‹'}}</text>
                <text>{{remainingTime}}å°æ—¶åç»“æŸ</text>
            </view>
            <view class="progress-info">
                <text>å½“å‰: {{currentHour}}:{{currentMinute}}</text>
                <text>{{isFasting ? 'ä¸‹æ¬¡è¿›é£Ÿ' : 'ä¸‹æ¬¡æ–­é£Ÿ'}}: {{isFasting ? eatingStart : eatingEnd}}</text>
            </view>
        </view>
    </view>

    <!-- ä»Šæ—¥è¿›é¤è®°å½• -->
    <view class="meal-section">
        <view class="section-header">
            <text class="section-title">ä»Šæ—¥è¿›é¤è®°å½•</text>
            <text class="meal-count">å·²è®°å½• {{todayMeals.length}} æ¬¡</text>
        </view>
        <view class="meal-scroll-container">
            <view class="meal-content">
                <view wx:if="{{todayMeals.length === 0}}" class="empty-tip">
                    <image src="/images/empty.png" class="empty-icon"></image>
                    <text>ä»Šæ—¥å°šæœªè®°å½•è¿›é¤</text>
                </view>
                <view wx:else class="meal-records">
                    <block wx:for="{{todayMeals}}" wx:key="item">
                        <view class="meal-item">
                            <view class="meal-time">{{item}}</view>
                            <view class="meal-type">{{getMealType(index)}}</view>
                            <view class="meal-actions">
                                <view class="edit-icon" bindtap="showTimePicker" data-index="{{index}}">âœ</view>
                                <view class="delete-icon" bindtap="deleteMeal" data-index="{{index}}">âœ•</view>
                            </view>
                        </view>
                    </block>
                </view>
            </view>
        </view>
    </view>

    <!-- æ—¶é—´é€‰æ‹©å™¨å¼¹çª— -->
    <view class="time-picker-modal" wx:if="{{showPicker}}">
        <view class="picker-container">
            <view class="picker-header">
                <text class="picker-title">ç¼–è¾‘è¿›é¤æ—¶é—´</text>
            </view>
            <picker mode="time" value="{{selectedTime}}" start="00:00" end="23:59" bindchange="timeChange">
                <view class="picker-display">
                    <text class="picker-time">{{selectedTime}}</text>
                    <text class="picker-hint">ç‚¹å‡»é€‰æ‹©æ—¶é—´</text>
                </view>
            </picker>
            <view class="picker-buttons">
                <button class="picker-btn cancel" bindtap="hidePicker">å–æ¶ˆ</button>
                <button class="picker-btn confirm" bindtap="updateMealTime">ç¡®å®š</button>
            </view>
        </view>
    </view>

    <!-- æµ®åŠ¨æŒ‰é’®ç»„ -->
    <view class="floating-actions">
        <button class="floating-button photo" bindtap="takeFoodPhoto">
            <view class="button-icon">ğŸ“·</view>
            <text>æ‹çƒ­é‡</text>
        </button>
        <button class="floating-button record" bindtap="recordMealNow">
            <view class="button-icon">+</view>
            <text>è®°å½•è¿›é¤</text>
        </button>
    </view>

    <!-- é£Ÿç‰©è¯†åˆ«ç»“æœå¼¹çª— -->
    <view class="food-result-modal" wx:if="{{showFoodResult}}">
        <view class="result-container">
            <view class="result-header">
                <text class="result-title">é£Ÿç‰©è¯†åˆ«ç»“æœ</text>
                <text class="close-icon" bindtap="closeFoodResult">Ã—</text>
            </view>
            <view class="recognition-results">
                <view class="result-item" wx:for="{{recognizedFoods}}" wx:key="index" 
                      bindtap="selectFood" data-index="{{index}}" 
                      class="{{selectedFoodIndex == index ? 'result-item-selected' : ''}}">
                    <view class="result-item-header">
                        <text class="food-name">{{item.name}}</text>
                        <text class="recognition-probability">åŒ¹é…åº¦ {{item.probability}}%</text>
                    </view>
                    <text class="food-calories">{{item.calories}}</text>
                </view>
            </view>
            <view class="selected-food-detail">
                <view class="food-image-container">
                    <image src="{{takenImagePath}}" mode="widthFix" binderror="onFoodImageError"></image>
                </view>
                <view class="food-info">
                    <text class="food-name">{{recognizedFood.name}}</text>
                    <text class="food-calories">{{recognizedFood.calories}}</text>
                    <view class="food-nutrition">
                        <text>è¯†åˆ«å¯ä¿¡åº¦ï¼š{{recognizedFood.probability}}%</text>
                    </view>
                </view>
                <view class="food-description" wx:if="{{recognizedFood.description}}">
                    <text class="advice-title">é£Ÿç‰©ç®€ä»‹</text>
                    <text class="advice-content">{{recognizedFood.description}}</text>
                </view>
                <view class="diet-advice">
                    <text class="advice-title">é¥®é£Ÿå»ºè®®</text>
                    <text class="advice-content">{{dietAdvice}}</text>
                </view>
            </view>
            <view class="result-buttons">
                <button class="result-btn cancel" bindtap="closeFoodResult">å–æ¶ˆ</button>
                <button class="result-btn confirm" bindtap="saveFoodRecord">è®°å½•ç”¨é¤</button>
            </view>
        </view>
    </view>

    <!-- æ“ä½œåé¦ˆæç¤º -->
    <view class="action-toast" wx:if="{{showMealActionToast}}">
        <text>{{mealActionFeedback}}</text>
    </view>
</view>